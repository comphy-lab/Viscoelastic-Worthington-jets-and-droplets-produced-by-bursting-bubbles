<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <!-- Eliminate FOUC (Flash of Unstyled Content) and FOUT (Flash of Incorrect Theme) -->
  <script>
    (function() {
  try {
    // Apply the theme as quickly as possible to avoid flash
    let saved;
    try {
      saved = localStorage.getItem('theme');
    } catch (storageError) {
      // Handle localStorage access errors (private browsing, cookies disabled)
      console.warn('Unable to access localStorage:', storageError);
    }

    let prefersDark = false;
    try {
      prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    } catch (mediaError) {
      // Handle matchMedia access errors (unsupported browsers)
      console.warn('Unable to check media query:', mediaError);
    }

    const theme = saved ? saved : (prefersDark ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', theme);
    // Add theme class for CSS targeting
    document.documentElement.classList.add(theme + '-theme');
    // Mark when theme is set for CSS transitions
    document.documentElement.classList.add('theme-set');
  } catch (error) {
    // Fallback for any other unexpected errors
    console.warn('Theme initialization failed:', error);
    // Apply default theme as fallback
    try {
      document.documentElement.setAttribute('data-theme', 'light');
      document.documentElement.classList.add('light-theme');
      document.documentElement.classList.add('theme-set');
    } catch (fallbackError) {
      // Silent catch for extreme cases
      console.error('Critical theme fallback failed:', fallbackError);
    }
  }
})();
  </script>


  <!-- No-JS fallback for theme and critical theming styles -->
  <style>
    /* Default light theme variables */
    :root {
      /* Base colors */
      --color-background: #fff;
      --color-text: #333;
      --color-primary: #0066cc;
      --color-secondary: #036;
      --color-accent: #0099ff;

      /* UI elements */
      --color-header-bg: #f5f5f5;
      --color-footer-bg: #2d2e33;
      --color-border: #e0e0e0;
      --color-input-bg: #f9f9f9;

      /* Component colors */
      --color-preloader-bg: #ffffff;
      --color-loader: #0066cc;
      --color-card-bg: #ffffff;
      --color-code-bg: #f5f5f5;
    }

    /* Dark theme variables applied via media query when JS is disabled */
    @media (prefers-color-scheme: dark) {
      :root:not(.theme-set) {
        /* Base colors - dark mode */
        --color-background: #1a1a1a;
        --color-text: #f5f5f5;
        --color-primary: #4d9fff;
        --color-secondary: #88ccff;
        --color-accent: #00bfff;

        /* UI elements - dark mode */
        --color-header-bg: #121212;
        --color-footer-bg: #121212;
        --color-border: #333;
        --color-input-bg: #2d2d2d;

        /* Component colors - dark mode */
        --color-preloader-bg: #1a1a1a;
        --color-loader: #4d9fff;
        --color-card-bg: #222;
        --color-code-bg: #2d2d2d;
      }
    }

    /* When JS sets the theme explicitly via data attribute */
    [data-theme="dark"] {
      /* Base colors - dark mode */
      --color-background: #1a1a1a;
      --color-text: #f5f5f5;
      --color-primary: #4d9fff;
      --color-secondary: #88ccff;
      --color-accent: #00bfff;

      /* UI elements - dark mode */
      --color-header-bg: #121212;
      --color-footer-bg: #121212;
      --color-border: #333;
      --color-input-bg: #2d2d2d;

      /* Component colors - dark mode */
      --color-preloader-bg: #1a1a1a;
      --color-loader: #4d9fff;
      --color-card-bg: #222;
      --color-code-bg: #2d2d2d;
    }

    /* Prevent transition flashes during initial load */
    html:not(.transitions-enabled) * {
      transition: none !important;
    }

    /* Apply theme to preloader and early elements */
    #preloader {
      background-color: var(--color-preloader-bg);
      color: var(--color-text);
    }

    #loader {
      border-color: var(--color-loader);
      border-top-color: transparent;
    }

    /* Noscript warning */
    .noscript-warning {
      background-color: var(--color-primary);
      color: white;
      text-align: center;
      padding: 10px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }

    /* Theme indicator for no-JS */
    .theme-indicator {
      padding: 5px 10px;
      border-radius: 4px;
      background-color: var(--color-input-bg);
      color: var(--color-text);
      text-align: center;
    }

    /* Hide JS-only elements when no JS */
    .no-js .js-only {
      display: none !important;
    }

    /* Show no-JS alternatives */
    .js .no-js-only {
      display: none !important;
    }
  </style>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="base-url" content="..">
  <title>simulationCases/burstingBubbleVE.c | Viscoelastic Worthington Jets & Droplets Produced by Bursting Bubbles</title>

  <!-- Critical CSS for fastest paint -->
  <style>
      .s-intro__title {
          visibility: visible;
          font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }
      .s-header {
          visibility: visible;
      }

      /* Ensure theme toggle properly styled immediately */
      .theme-toggle {
          background-color: var(--color-background);
          color: var(--color-text);
      }

      /* Control SVG visibility based on theme */
      [data-theme="dark"] .theme-toggle-icon.sun,
      :root:not([data-theme="dark"]) .theme-toggle-icon.moon {
          display: block;
      }

      [data-theme="dark"] .theme-toggle-icon.moon,
      :root:not([data-theme="dark"]) .theme-toggle-icon.sun {
          display: none;
      }
  </style>

  <!-- Critical Meta Tags -->
  <meta name="description" content="This simulation models the dynamics of bursting bubbles in viscoelastic media using the Basilisk framework. It particularly focuses on the formation of Worth...">
  <meta name="author" content="CoMPhy Lab">
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="attempts, axi.h, burstingbubbleve, distance.h, log-conform-viscoelastic-scalar-2d.h, log-conform-viscoelastic.h, method, navier-stokes/conserving.h, tension.h, two-phaseve.h">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <meta name="apple-mobile-web-app-title" content="CoMPhy Lab">

  <!-- Preload critical resources -->
  <link rel="preload" href="../assets/js/main.js" as="script">
  <link rel="preload" href="../assets/css/fontello/css/fontello.css" as="style">
  <link rel="preload" href="../assets/css/academicons-1.7.0/css/academicons.min.css" as="style">

  <!-- Base stylesheets -->
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="stylesheet" href="../assets/css/custom_styles.css">
  <link rel="stylesheet" href="../assets/css/command-palette.css">
  <link rel="stylesheet" href="../assets/css/fontello/css/fontello.css">
  <link rel="stylesheet" href="../assets/css/academicons-1.7.0/css/academicons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">

  <!-- Font optimization -->
  <style>
      @font-face {
          font-display: swap;
          font-family: 'System Font';
          src: local('system-ui');
      }
  </style>

  <!-- Favicon -->
  <link rel="apple-touch-icon" sizes="180x180" href="../assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../assets/favicon/favicon-96x96.png">
  <link rel="icon" type="image/svg+xml" href="../assets/favicon/favicon.svg">
  <link rel="shortcut icon" href="../assets/favicon/favicon.ico">
  <link rel="manifest" href="../assets/favicon/site.webmanifest">

  <!-- Scripts with proper loading attributes -->
  <script src="../assets/js/jquery.min.js"></script>
  <script src="../assets/js/jquery-ui.packed.js"></script>
  <script src="../assets/js/plots.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
  <!-- Config script must load before other scripts -->
  <script src="../assets/js/config.js"></script>
  <script defer src="../assets/js/search-helper.js"></script>
  <script defer src="../assets/js/command-palette.js"></script>
  <script defer src="../assets/js/command-data.js"></script>
  <script defer src="../assets/js/main.js"></script>
  <script defer src="../assets/js/theme-toggle.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" id="MathJax-script"></script>

  <!-- Optimize page load performance -->
  <script>
    // Preconnect to critical domains
    const preconnectDomains = [
      'https://cdnjs.cloudflare.com',
      'https://cdn.jsdelivr.net'
    ];

    preconnectDomains.forEach(domain => {
      const link = document.createElement('link');
      link.rel = 'preconnect';
      link.href = domain;
      link.crossOrigin = 'anonymous';
      document.head.appendChild(link);

      // Also add DNS prefetch as fallback
      const dnsLink = document.createElement('link');
      dnsLink.rel = 'dns-prefetch';
      dnsLink.href = domain;
      document.head.appendChild(dnsLink);
    });

    // Detect when document is fully loaded to remove preloader
    window.addEventListener('load', function() {
      const preloader = document.getElementById('preloader');
      if (preloader) {
        preloader.style.opacity = '0';
        setTimeout(() => {
          preloader.style.display = 'none';
        }, 300); // Match transition duration
      }
    });
  </script>

  <script>
      // Load Font Awesome with proper environment detection and fallbacks
      function loadStylesheet(href) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = href;
        link.crossOrigin = 'anonymous';
        link.onerror = (e) => {
          console.error(`Failed to load stylesheet: `, e);
          console.log('Trying alternative Font Awesome source...');
        };
        document.head.appendChild(link);
        return link;
      }

      // Check if we're on localhost
      if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        // Use hardcoded version numbers for reliable loading

        // Load Font Awesome using multiple CDNs to maximize reliability for local development
        loadStylesheet('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css');
        // Backup CDN if the first one fails
        loadStylesheet('https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css');
        // Final local fallback - ensures it will work on any localhost environment
        loadStylesheet('https://use.fontawesome.com/releases/v6.7.2/css/all.css');
      } else {
        // Use Kit for production with defer
        var script = document.createElement('script');
        script.src = 'https://kit.fontawesome.com/b1cfd9ca75.js';
        script.crossOrigin = 'anonymous';
        script.defer = true;
        document.head.appendChild(script);
      }
    </script>

  <script>
      // Mark page as JS-enabled and manage transitions
      document.documentElement.classList.remove('no-js');
      document.documentElement.classList.add('js');

      // Allow CSS transitions after initial load to prevent transition flashes
      window.addEventListener('DOMContentLoaded', () => {
          setTimeout(() => {
              document.documentElement.classList.add('transitions-enabled');
          }, 100); // Short delay to ensure DOM is ready
      });
  </script>
</head>
<body id="top">
<script>window.repoName = "Viscoelastic-Worthington-jets-and-droplets-produced-by-bursting-bubbles";</script>


    <!-- Preloader with theme variables applied -->
    <div id="preloader">
        <div id="loader"></div>
    </div>

    <noscript>
        <div class="noscript-warning">
            <p>This site works best with JavaScript enabled. Some features may be limited.</p>
        </div>
    </noscript>

    <div id="page" class="s-pagewrap">
        <header class="s-header">
            <div class="s-header__logo">
                <a class="logo" href="/">
                    <img src="../assets/logos/CoMPhy-Lab-no-name.png" alt="CoMPhy Lab">
                </a>
                <a class="documentation-button" href="/Viscoelastic-Worthington-jets-and-droplets-produced-by-bursting-bubbles">
                    <i class="fa-solid fa-book-open"></i>
                    <span>Viscoelastic-Worthington-jets-and-droplets-produced-by-bursting-bubbles</span>
                </a>
            </div>
            <a class="s-header__menu-toggle" href="#0">
                <span class="s-header__menu-text">Menu</span>
                <span class="s-header__menu-icon"></span>
            </a>
            <nav class="s-header__nav">
                <a href="#0" class="s-header__nav-close-btn"><span>Close</span></a>
                <ul class="s-header__nav-list">
                    <li style="background: none;">
                        <!-- JS theme toggle -->
                        <div class="theme-toggle js-only" id="theme-toggle" aria-label="Toggle dark/light theme">
                            <svg class="theme-toggle-icon moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                            <svg class="theme-toggle-icon sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                        </div>
                    </li>
                    <li style="background: none;"><a href="https://scholar.google.com/citations?user=tHb_qZoAAAAJ&hl=en" style="background: none; padding: 0;" aria-label="Google Scholar Profile"><i class="ai ai-google-scholar" style="font-size: 1.75em;"></i></a></li>
                    <li style="background: none;"><a href="https://github.com/comphy-lab" style="background: none; padding: 0;" aria-label="GitHub Organization"><i class="fa-brands fa-github" style="font-size: 1.75em"></i></a></li>
                    <li><a href="https://comphy-lab.org/#about" class="smoothscroll">About</a></li>
                    <li><a href="https://comphy-lab.org/team/">Team</a></li>
                    <li><a href="https://comphy-lab.org/research">Research</a></li>
                    <li><a href="https://comphy-lab.org/teaching">Teaching</a></li>
                    <li><a href="https://comphy-lab.org/join">Join Us</a></li>
                    <li><a href="https://blogs.comphy-lab.org/">Blog</a></li>
                    <li style="background: none;"><a href="https://bsky.app/profile/comphy-lab.org" style="background: none; padding: 0;" aria-label="Bluesky Profile"><i class="fa-brands fa-bluesky" style="font-size: 1.75em; color: #0085ff;"></i></a></li>
                    <!-- Command Palette Button (Styled like search) -->
                    <li class="command-palette-button">
                        <div class="command-wrapper">
                            <button class="command-k-style-btn" id="command-palette-btn" aria-label="Open command palette">
                                <span class="default-theme-text">ctrl K</span>
                                <span class="mac-theme-text">⌘ K</span>
                                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                            </button>
                        </div>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- Main content -->
        <main class="content">

            <div class="page-content">

                                <h1 class="page-title">simulationCases/burstingBubbleVE.c</h1>


                                <div class="raw-file-button-container">
                    <a href="https://github.com/comphy-lab/Viscoelastic-Worthington-jets-and-droplets-produced-by-bursting-bubbles/raw/main/simulationCases/burstingBubbleVE.c" class="raw-file-button" target="_blank">
                        <i class="fa-brands fa-github"></i> See raw file
                    </a>
                </div>

                <h1
                id="bursting-bubbles-in-viscoelastic-media-simulation">Bursting
                Bubbles in Viscoelastic Media Simulation</h1>
                <p>This simulation models the dynamics of bursting
                bubbles in viscoelastic media using the Basilisk
                framework. It particularly focuses on the formation of
                Worthington jets and droplets that emerge during the
                bursting process.</p>
                <h2 id="physics-overview">Physics Overview</h2>
                <p>The simulation implements a two-phase flow model with
                viscoelastic properties, utilizing the log-conformation
                approach for numerical stability. This approach
                preserves the positive-definiteness of the conformation
                tensor, which is crucial for stable simulations of
                viscoelastic fluids at high Deborah numbers.</p>
                <p>For theoretical details, see: V. Sanjay, Zenodo, DOI:
                10.5281/zenodo.14210635 (2024)</p>
                <h2 id="usage">Usage</h2>
                <div class="code-block-container"><pre><code>./program maxLevel De Ec Oh Bond tmax</code></pre></div>
                <p>Where: - <code>maxLevel</code>: Maximum refinement
                level for adaptive mesh - <code>De</code>: Deborah
                number (ratio of relaxation time to flow time) -
                <code>Ec</code>: Elasto-capillary number (ratio of
                elastic to surface tension forces) - <code>Oh</code>:
                Ohnesorge number (ratio of viscous to inertial-capillary
                forces) - <code>Bond</code>: Bond number (ratio of
                gravitational to surface tension forces) -
                <code>tmax</code>: Maximum simulation time</p>
                <p><span class="citation" data-cites="file">@file</span>
                burstingBubbleVE.c <span class="citation"
                data-cites="author">@author</span> Vatsal Sanjay and
                Ayush Dixit <span class="citation"
                data-cites="version">@version</span> 1.0 <span
                class="citation" data-cites="date">@date</span> Nov 23,
                2024 - Work used in the paper: DOI:
                10.1017/jfm.2025.237</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><span class="pp">#include </span><a href="http://basilisk.fr/src/axi.h" title="Link to Basilisk source for axi.h"><span class="im">"axi.h"</span></a></span>
<span id="cb2-2"><span class="pp">#include </span><a href="http://basilisk.fr/src/navier-stokes/centered.h" title="Link to Basilisk source for navier-stokes/centered.h"><span class="im">"navier-stokes/centered.h"</span></a></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co">// Uncomment to use the scalar version of the viscoelastic code</span></span>
<span id="cb2-5"><span class="co">// #define _SCALAR</span></span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="pp">#if !_SCALAR</span></span>
<span id="cb2-8"><span class="pp">#include </span><a href="../src-local/log-conform-viscoelastic.h.html" title="Link to local documentation for log-conform-viscoelastic.h"><span class="im">"log-conform-viscoelastic.h"</span></a></span>
<span id="cb2-9"><span class="pp">#else</span></span>
<span id="cb2-10"><span class="pp">#include </span><a href="../src-local/log-conform-viscoelastic-scalar-2D.h.html" title="Link to local documentation for log-conform-viscoelastic-scalar-2D.h"><span class="im">"log-conform-viscoelastic-scalar-2D.h"</span></a></span>
<span id="cb2-11"><span class="pp">#endif</span></span></code></pre></div></div>
                <h2 id="simulation-parameters">Simulation
                Parameters</h2>
                <ul>
                <li><code>FILTERED</code>: Enable density and viscosity
                jump smoothing</li>
                <li><code>tsnap</code>: Time interval between snapshots
                (default: 1e-2)</li>
                <li><code>fErr</code>: Error tolerance for volume
                fraction (1e-3)</li>
                <li><code>KErr</code>: Error tolerance for curvature
                calculation (1e-6)</li>
                <li><code>VelErr</code>: Error tolerance for velocity
                field (1e-3)</li>
                <li><code>AErr</code>: Error tolerance for conformation
                tensor (1e-3)</li>
                <li><code>Ldomain</code>: Domain size in characteristic
                lengths (8)</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><span class="pp">#define FILTERED </span><span class="co">// Smear density and viscosity jumps</span></span>
<span id="cb3-2"><span class="pp">#include </span><a href="../src-local/two-phaseVE.h.html" title="Link to local documentation for two-phaseVE.h"><span class="im">"two-phaseVE.h"</span></a></span>
<span id="cb3-3"><span class="pp">#include </span><a href="http://basilisk.fr/src/navier-stokes/conserving.h" title="Link to Basilisk source for navier-stokes/conserving.h"><span class="im">"navier-stokes/conserving.h"</span></a></span>
<span id="cb3-4"><span class="pp">#include </span><a href="http://basilisk.fr/src/tension.h" title="Link to Basilisk source for tension.h"><span class="im">"tension.h"</span></a></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="pp">#if !_MPI</span></span>
<span id="cb3-7"><span class="pp">#include </span><a href="http://basilisk.fr/src/distance.h" title="Link to Basilisk source for distance.h"><span class="im">"distance.h"</span></a></span>
<span id="cb3-8"><span class="pp">#endif</span></span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="pp">#define tsnap </span><span class="op">(</span><span class="fl">1e-2</span><span class="op">)</span><span class="pp"> </span><span class="co">// 0.001 only for some cases.</span></span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="co">// Error tolerances</span></span>
<span id="cb3-13"><span class="pp">#define fErr </span><span class="op">(</span><span class="fl">1e-3</span><span class="op">)</span><span class="pp">  </span><span class="co">// Error tolerance in f1 VOF</span></span>
<span id="cb3-14"><span class="pp">#define KErr </span><span class="op">(</span><span class="fl">1e-6</span><span class="op">)</span><span class="pp">  </span><span class="co">// Error tolerance in VoF curvature calculated using height function method</span></span>
<span id="cb3-15"><span class="pp">#define VelErr </span><span class="op">(</span><span class="fl">1e-3</span><span class="op">)</span><span class="pp"> </span><span class="co">// Error tolerances in velocity - Use 1e-2 for low Oh and 1e-3 to 5e-3 for high Oh/moderate to high J</span></span>
<span id="cb3-16"><span class="pp">#define AErr </span><span class="op">(</span><span class="fl">1e-3</span><span class="op">)</span><span class="pp">   </span><span class="co">// Error tolerances in conformation inside the liquid</span></span>
<span id="cb3-17"></span>
<span id="cb3-18"><span class="co">// Domain size</span></span>
<span id="cb3-19"><span class="pp">#define Ldomain </span><span class="dv">8</span><span class="pp"></span><span class="dv">79</span><span class="pp"></span></span>
<span id="cb3-20"></span>
<span id="cb3-21"><span class="co">// Boundary conditions - outflow on the right boundary</span></span>
<span id="cb3-22">u<span class="op">.</span>n<span class="op">[</span>right<span class="op">]</span> <span class="op">=</span> neumann<span class="op">(</span><span class="fl">0.</span><span class="op">);</span></span>
<span id="cb3-23">p<span class="op">[</span>right<span class="op">]</span> <span class="op">=</span> dirichlet<span class="op">(</span><span class="fl">0.</span><span class="op">);</span></span>
<span id="cb3-24"></span>
<span id="cb3-25"><span class="dt">int</span> MAXlevel<span class="op">;</span></span>
<span id="cb3-26"><span class="co">// Physical parameters:</span></span>
<span id="cb3-27"><span class="co">// Oh -&gt; Solvent Ohnesorge number</span></span>
<span id="cb3-28"><span class="co">// Oha -&gt; air Ohnesorge number</span></span>
<span id="cb3-29"><span class="co">// De -&gt; Deborah number</span></span>
<span id="cb3-30"><span class="co">// Ec -&gt; Elasto-capillary number</span></span>
<span id="cb3-31"><span class="dt">double</span> Oh<span class="op">,</span> Oha<span class="op">,</span> De<span class="op">,</span> Ec<span class="op">,</span> Bond<span class="op">,</span> tmax<span class="op">;</span></span>
<span id="cb3-32"><span class="dt">char</span> nameOut<span class="op">[</span><span class="dv">80</span><span class="op">],</span> dumpFile<span class="op">[</span><span class="dv">80</span><span class="op">];</span></span></code></pre></div></div>
                <h2 id="main-function">Main Function</h2>
                <p>Initializes the simulation parameters and sets up the
                domain.</p>
                <ul>
                <li>Uses command line arguments to set simulation
                parameters</li>
                <li>Sets up the physical domain with appropriate
                dimensions</li>
                <li>Configures fluid properties for both phases</li>
                <li>Creates necessary directories for output</li>
                </ul>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="dt">const</span> <span class="op">*</span>argv<span class="op">[])</span> <span class="op">{</span></span>
<span id="cb4-2">  dtmax <span class="op">=</span> <span class="fl">1e-5</span><span class="op">;</span> <span class="co">// BEWARE of this for stability issues.</span></span>
<span id="cb4-3"></span>
<span id="cb4-4">  L0 <span class="op">=</span> Ldomain<span class="op">;</span></span>
<span id="cb4-5">  origin<span class="op">(-</span>L0<span class="op">/</span><span class="fl">2.</span><span class="op">,</span> <span class="fl">0.</span><span class="op">);</span></span>
<span id="cb4-6"></span>
<span id="cb4-7">  <span class="co">// Values taken from the terminal. Here we use some representative values.</span></span>
<span id="cb4-8">  <span class="co">// In production run, you can pass it from the command line.</span></span>
<span id="cb4-9">  MAXlevel <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> <span class="co">// atoi(argv[1]);</span></span>
<span id="cb4-10">  De <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span>      <span class="co">// atof(argv[2]); // Use 1e30 to simulate the De → ∞ limit</span></span>
<span id="cb4-11">  Ec <span class="op">=</span> <span class="fl">0.01</span><span class="op">;</span>     <span class="co">// atof(argv[3]);</span></span>
<span id="cb4-12">  Oh <span class="op">=</span> <span class="fl">1e-2</span><span class="op">;</span>     <span class="co">// atof(argv[4]);</span></span>
<span id="cb4-13">  Bond <span class="op">=</span> <span class="fl">1e-3</span><span class="op">;</span>   <span class="co">// atof(argv[5]);</span></span>
<span id="cb4-14">  tmax <span class="op">=</span> <span class="fl">1e0</span><span class="op">;</span>    <span class="co">// atof(argv[6]);</span></span>
<span id="cb4-15"></span>
<span id="cb4-16">  <span class="co">// Ensure that all the variables were transferred properly from the terminal or job script.</span></span>
<span id="cb4-17">  <span class="co">// if (argc &lt; 7){</span></span>
<span id="cb4-18">  <span class="co">//   fprintf(ferr, &quot;Lack of command line arguments. Check! Need %d more arguments\n&quot;, 7-argc);</span></span>
<span id="cb4-19">  <span class="co">//   return 1;</span></span>
<span id="cb4-20">  <span class="co">// }</span></span>
<span id="cb4-21"></span>
<span id="cb4-22">  init_grid<span class="op">(</span><span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb4-23"></span>
<span id="cb4-24">  <span class="co">// Create a folder named intermediate where all the simulation snapshots are stored.</span></span>
<span id="cb4-25">  <span class="dt">char</span> comm<span class="op">[</span><span class="dv">80</span><span class="op">];</span></span>
<span id="cb4-26">  sprintf<span class="op">(</span>comm<span class="op">,</span> <span class="st">&quot;mkdir -p intermediate&quot;</span><span class="op">);</span></span>
<span id="cb4-27">  system<span class="op">(</span>comm<span class="op">);</span></span>
<span id="cb4-28"></span>
<span id="cb4-29">  <span class="co">// Name of the restart file. See writingFiles event.</span></span>
<span id="cb4-30">  sprintf<span class="op">(</span>dumpFile<span class="op">,</span> <span class="st">&quot;restart&quot;</span><span class="op">);</span></span></code></pre></div></div>
                <h2 id="physical-properties-configuration">Physical
                Properties Configuration</h2>
                <p>Sets up the material properties for both phases: -
                <code>rho1</code>, <code>rho2</code>: Density of liquid
                and gas phases - <code>mu1</code>, <code>mu2</code>:
                Dynamic viscosity of liquid and gas phases -
                <code>lambda1</code>, <code>lambda2</code>: Relaxation
                times - <code>G1</code>, <code>G2</code>: Elastic
                moduli</p>
                <p>Dimensionless parameters: - <code>Oh</code>:
                Ohnesorge number for liquid phase - <code>Oha</code>:
                Ohnesorge number for gas phase (= 2e-2 * Oh) -
                <code>De</code>: Deborah number - <code>Ec</code>:
                Elasto-capillary number - <code>Bond</code>: Bond
                number</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb5-1">  rho1 <span class="op">=</span> <span class="fl">1.</span><span class="op">,</span> rho2 <span class="op">=</span> <span class="fl">1e-3</span><span class="op">;</span></span>
<span id="cb5-2">  Oha <span class="op">=</span> <span class="fl">2e-2</span> <span class="op">*</span> Oh<span class="op">;</span></span>
<span id="cb5-3">  mu1 <span class="op">=</span> Oh<span class="op">,</span> mu2 <span class="op">=</span> Oha<span class="op">;</span></span>
<span id="cb5-4">  lambda1 <span class="op">=</span> De<span class="op">;</span> lambda2 <span class="op">=</span> <span class="fl">0.</span><span class="op">;</span></span>
<span id="cb5-5">  G1 <span class="op">=</span> Ec<span class="op">;</span> G2 <span class="op">=</span> <span class="fl">0.</span><span class="op">;</span></span>
<span id="cb5-6"></span>
<span id="cb5-7">  f<span class="op">.</span>sigma <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb5-8"></span>
<span id="cb5-9">  TOLERANCE <span class="op">=</span> <span class="fl">1e-4</span><span class="op">;</span></span>
<span id="cb5-10">  CFL <span class="op">=</span> <span class="fl">1e-1</span><span class="op">;</span></span>
<span id="cb5-11"></span>
<span id="cb5-12">  run<span class="op">();</span></span>
<span id="cb5-13"><span class="op">}</span></span></code></pre></div></div>
                <h2 id="initialization-event">Initialization Event</h2>
                <p>Sets up the initial conditions for the
                simulation.</p>
                <p>The function attempts to restore from a dump file
                first. If that fails: - For MPI runs: Ends with an error
                - For non-MPI runs: Tries to load an initial shape from
                a data file, creates a distance field, and initializes
                the volume fraction</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb6-1">event init<span class="op">(</span>t <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-2"><span class="pp">#if _MPI </span><span class="co">// This is for supercomputers without OpenMP support</span></span>
<span id="cb6-3">  <span class="cf">if</span> <span class="op">(!</span>restore<span class="op">(</span>file <span class="op">=</span> dumpFile<span class="op">))</span> <span class="op">{</span></span>
<span id="cb6-4">    fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;Cannot restored from a dump file!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb6-5">  <span class="op">}</span></span>
<span id="cb6-6"><span class="pp">#else  </span><span class="co">// Note that distance.h is incompatible with OpenMPI. So, the below code should not be used with MPI</span></span>
<span id="cb6-7">  <span class="cf">if</span> <span class="op">(!</span>restore<span class="op">(</span>file <span class="op">=</span> dumpFile<span class="op">))</span> <span class="op">{</span></span>
<span id="cb6-8">    <span class="dt">char</span> filename<span class="op">[</span><span class="dv">60</span><span class="op">];</span></span>
<span id="cb6-9">    sprintf<span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;Bo</span><span class="sc">%5.4f</span><span class="st">.dat&quot;</span><span class="op">,</span> Bond<span class="op">);</span></span>
<span id="cb6-10">    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;rb&quot;</span><span class="op">);</span></span>
<span id="cb6-11">    <span class="cf">if</span> <span class="op">(</span>fp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-12">      fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;There is no file named </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> filename<span class="op">);</span></span>
<span id="cb6-13">      <span class="co">// Try in folder one level up</span></span>
<span id="cb6-14">      sprintf<span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;../Bo</span><span class="sc">%5.4f</span><span class="st">.dat&quot;</span><span class="op">,</span> Bond<span class="op">);</span></span>
<span id="cb6-15">      fp <span class="op">=</span> fopen<span class="op">(</span>filename<span class="op">,</span> <span class="st">&quot;rb&quot;</span><span class="op">);</span></span>
<span id="cb6-16">      <span class="cf">if</span> <span class="op">(</span>fp <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-17">        fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;There is no file named </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> filename<span class="op">);</span></span>
<span id="cb6-18">        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb6-19">      <span class="op">}</span></span>
<span id="cb6-20">    <span class="op">}</span></span>
<span id="cb6-21">    coord <span class="op">*</span>InitialShape<span class="op">;</span></span>
<span id="cb6-22">    InitialShape <span class="op">=</span> input_xy<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb6-23">    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb6-24">    scalar d<span class="op">[];</span></span>
<span id="cb6-25">    distance<span class="op">(</span>d<span class="op">,</span> InitialShape<span class="op">);</span></span>
<span id="cb6-26"></span>
<span id="cb6-27">    <span class="cf">while</span> <span class="op">(</span>adapt_wavelet<span class="op">((</span>scalar <span class="op">*){</span>f<span class="op">,</span> d<span class="op">},</span> <span class="op">(</span><span class="dt">double</span><span class="op">[]){</span><span class="fl">1e-8</span><span class="op">,</span> <span class="fl">1e-8</span><span class="op">},</span> MAXlevel<span class="op">).</span>nf<span class="op">);</span></span>
<span id="cb6-28"></span>
<span id="cb6-29">    <span class="co">// The distance function is defined at the center of each cell, we have</span></span>
<span id="cb6-30">    <span class="co">// to calculate the value of this function at each vertex.</span></span>
<span id="cb6-31">    vertex scalar phi<span class="op">[];</span></span>
<span id="cb6-32">    foreach_vertex<span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-33">      phi<span class="op">[]</span> <span class="op">=</span> <span class="op">-(</span>d<span class="op">[]</span> <span class="op">+</span> d<span class="op">[-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> d<span class="op">[</span><span class="dv">0</span><span class="op">,-</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> d<span class="op">[-</span><span class="dv">1</span><span class="op">,-</span><span class="dv">1</span><span class="op">])/</span><span class="fl">4.</span><span class="op">;</span></span>
<span id="cb6-34">    <span class="op">}</span></span>
<span id="cb6-35"></span>
<span id="cb6-36">    <span class="co">// We can now initialize the volume fraction of the domain.</span></span>
<span id="cb6-37">    fractions<span class="op">(</span>phi<span class="op">,</span> f<span class="op">);</span></span>
<span id="cb6-38">  <span class="op">}</span></span>
<span id="cb6-39">  <span class="co">// return 1;</span></span>
<span id="cb6-40"><span class="pp">#endif</span></span>
<span id="cb6-41"><span class="op">}</span></span></code></pre></div></div>
                <h2 id="adaptive-mesh-refinement">Adaptive Mesh
                Refinement</h2>
                <p>Refines the mesh based on gradients of key fields: -
                Volume fraction - Velocity components - Conformation
                tensor components - Curvature</p>
                <p>The refinement criteria are set by the error
                tolerance parameters defined at the beginning of the
                file. This adaptive approach allows for high resolution
                in regions of interest while maintaining computational
                efficiency.</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb7-1">event adapt<span class="op">(</span>i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb7-2">  scalar KAPPA<span class="op">[];</span></span>
<span id="cb7-3">  curvature<span class="op">(</span>f<span class="op">,</span> KAPPA<span class="op">);</span></span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="pp">#if !_SCALAR</span></span>
<span id="cb7-6">  adapt_wavelet<span class="op">((</span>scalar <span class="op">*){</span>f<span class="op">,</span> u<span class="op">.</span>x<span class="op">,</span> u<span class="op">.</span>y<span class="op">,</span> conform_p<span class="op">.</span>x<span class="op">.</span>x<span class="op">,</span> conform_p<span class="op">.</span>y<span class="op">.</span>y<span class="op">,</span> conform_p<span class="op">.</span>y<span class="op">.</span>x<span class="op">,</span> conform_qq<span class="op">,</span> KAPPA<span class="op">},</span></span>
<span id="cb7-7">    <span class="op">(</span><span class="dt">double</span><span class="op">[]){</span>fErr<span class="op">,</span> VelErr<span class="op">,</span> VelErr<span class="op">,</span> AErr<span class="op">,</span> AErr<span class="op">,</span> AErr<span class="op">,</span> AErr<span class="op">,</span> KErr<span class="op">},</span></span>
<span id="cb7-8">    MAXlevel<span class="op">,</span> MAXlevel<span class="op">-</span><span class="dv">6</span><span class="op">);</span></span>
<span id="cb7-9"><span class="pp">#else</span></span>
<span id="cb7-10">  adapt_wavelet<span class="op">((</span>scalar <span class="op">*){</span>f<span class="op">,</span> u<span class="op">.</span>x<span class="op">,</span> u<span class="op">.</span>y<span class="op">,</span> A11<span class="op">,</span> A22<span class="op">,</span> A12<span class="op">,</span> AThTh<span class="op">,</span> KAPPA<span class="op">},</span></span>
<span id="cb7-11">    <span class="op">(</span><span class="dt">double</span><span class="op">[]){</span>fErr<span class="op">,</span> VelErr<span class="op">,</span> VelErr<span class="op">,</span> AErr<span class="op">,</span> AErr<span class="op">,</span> AErr<span class="op">,</span> AErr<span class="op">,</span> KErr<span class="op">},</span></span>
<span id="cb7-12">    MAXlevel<span class="op">,</span> MAXlevel<span class="op">-</span><span class="dv">6</span><span class="op">);</span></span>
<span id="cb7-13"><span class="pp">#endif</span></span>
<span id="cb7-14"><span class="op">}</span></span></code></pre></div></div>
                <h2 id="output-management">Output Management</h2>
                <p>Creates periodic snapshots of the simulation state. -
                Dumps restart files for simulation recovery - Saves
                intermediate snapshots at regular intervals defined by
                <code>tsnap</code></p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb8-1">event writingFiles<span class="op">(</span>t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> t <span class="op">+=</span> tsnap<span class="op">;</span> t <span class="op">&lt;=</span> tmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-2">  dump<span class="op">(</span>file <span class="op">=</span> dumpFile<span class="op">);</span></span>
<span id="cb8-3">  sprintf<span class="op">(</span>nameOut<span class="op">,</span> <span class="st">&quot;intermediate/snapshot-</span><span class="sc">%5.4f</span><span class="st">&quot;</span><span class="op">,</span> t<span class="op">);</span></span>
<span id="cb8-4">  dump<span class="op">(</span>file <span class="op">=</span> nameOut<span class="op">);</span></span>
<span id="cb8-5"><span class="op">}</span></span></code></pre></div></div>
                <h2 id="simulation-termination">Simulation
                Termination</h2>
                <p>Writes a final summary of the simulation parameters
                when the simulation ends.</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb9-1">event end<span class="op">(</span>t <span class="op">=</span> end<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-2">  <span class="cf">if</span> <span class="op">(</span>pid<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb9-3">    fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;Level </span><span class="sc">%d</span><span class="st">, De </span><span class="sc">%2.1e</span><span class="st">, Ec </span><span class="sc">%2.1e</span><span class="st">, Oh </span><span class="sc">%2.1e</span><span class="st">, Oha </span><span class="sc">%2.1e</span><span class="st">, Bo </span><span class="sc">%4.3f\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb9-4">            MAXlevel<span class="op">,</span> De<span class="op">,</span> Ec<span class="op">,</span> Oh<span class="op">,</span> Oha<span class="op">,</span> Bond<span class="op">);</span></span>
<span id="cb9-5"><span class="op">}</span></span></code></pre></div></div>
                <h2 id="simulation-logging">Simulation Logging</h2>
                <p>Records key simulation data at each timestep: -
                Iteration number - Timestep size - Current simulation
                time - Kinetic energy</p>
                <p>Also performs safety checks: - Monitors kinetic
                energy for stability - Terminates simulation if energy
                becomes too high or too low - Creates log files for
                post-processing analysis</p>
                <div class="code-block-container"><div class="code-block-container"><pre
                class="sourceCode c"><code class="sourceCode c"><span id="cb10-1">event logWriting<span class="op">(</span>i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb10-2">  <span class="co">// Calculate kinetic energy</span></span>
<span id="cb10-3">  <span class="dt">double</span> ke <span class="op">=</span> <span class="fl">0.</span><span class="op">;</span></span>
<span id="cb10-4">  foreach<span class="op">(</span>reduction<span class="op">(+:</span>ke<span class="op">))</span> <span class="op">{</span></span>
<span id="cb10-5">    ke <span class="op">+=</span> <span class="op">(</span><span class="dv">2</span><span class="op">*</span>pi<span class="op">*</span>y<span class="op">)*(</span><span class="fl">0.5</span><span class="op">*</span>rho<span class="op">(</span>f<span class="op">[])*(</span>sq<span class="op">(</span>u<span class="op">.</span>x<span class="op">[])</span> <span class="op">+</span> sq<span class="op">(</span>u<span class="op">.</span>y<span class="op">[])))*</span>sq<span class="op">(</span>Delta<span class="op">);</span></span>
<span id="cb10-6">  <span class="op">}</span></span>
<span id="cb10-7"></span>
<span id="cb10-8">  <span class="cf">if</span> <span class="op">(</span>pid<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-9">    <span class="dt">static</span> <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span></span>
<span id="cb10-10">    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-11">      fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;Level </span><span class="sc">%d</span><span class="st">, De </span><span class="sc">%2.1e</span><span class="st">, Ec </span><span class="sc">%2.1e</span><span class="st">, Oh </span><span class="sc">%2.1e</span><span class="st">, Oha </span><span class="sc">%2.1e</span><span class="st">, Bo </span><span class="sc">%4.3f\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb10-12">              MAXlevel<span class="op">,</span> De<span class="op">,</span> Ec<span class="op">,</span> Oh<span class="op">,</span> Oha<span class="op">,</span> Bond<span class="op">);</span></span>
<span id="cb10-13">      fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;De Ec Oh i dt t ke</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-14">      fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;log&quot;</span><span class="op">,</span> <span class="st">&quot;w&quot;</span><span class="op">);</span></span>
<span id="cb10-15">      fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;Level </span><span class="sc">%d</span><span class="st">, De </span><span class="sc">%2.1e</span><span class="st">, Ec </span><span class="sc">%2.1e</span><span class="st">, Oh </span><span class="sc">%2.1e</span><span class="st">, Oha </span><span class="sc">%2.1e</span><span class="st">, Bo </span><span class="sc">%4.3f\n</span><span class="st">&quot;</span><span class="op">,</span></span>
<span id="cb10-16">              MAXlevel<span class="op">,</span> De<span class="op">,</span> Ec<span class="op">,</span> Oh<span class="op">,</span> Oha<span class="op">,</span> Bond<span class="op">);</span></span>
<span id="cb10-17">      fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;i dt t ke</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-18">      fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> dt<span class="op">,</span> t<span class="op">,</span> ke<span class="op">);</span></span>
<span id="cb10-19">      fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb10-20">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb10-21">      fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;log&quot;</span><span class="op">,</span> <span class="st">&quot;a&quot;</span><span class="op">);</span></span>
<span id="cb10-22">      fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> dt<span class="op">,</span> t<span class="op">,</span> ke<span class="op">);</span></span>
<span id="cb10-23">      fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb10-24">    <span class="op">}</span></span>
<span id="cb10-25">    fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g</span><span class="st"> </span><span class="sc">%g\n</span><span class="st">&quot;</span><span class="op">,</span> i<span class="op">,</span> dt<span class="op">,</span> t<span class="op">,</span> ke<span class="op">);</span></span>
<span id="cb10-26"></span>
<span id="cb10-27">    assert<span class="op">(</span>ke <span class="op">&gt;</span> <span class="op">-</span><span class="fl">1e-10</span><span class="op">);</span></span>
<span id="cb10-28"></span>
<span id="cb10-29">    <span class="co">// Check for energy blowup (numerical instability)</span></span>
<span id="cb10-30">    <span class="cf">if</span> <span class="op">(</span>ke <span class="op">&gt;</span> <span class="fl">1e2</span> <span class="op">&amp;&amp;</span> i <span class="op">&gt;</span> <span class="fl">1e1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-31">      <span class="cf">if</span> <span class="op">(</span>pid<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-32">        fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;The kinetic energy blew up. Stopping simulation</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-33">        fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;log&quot;</span><span class="op">,</span> <span class="st">&quot;a&quot;</span><span class="op">);</span></span>
<span id="cb10-34">        fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;The kinetic energy blew up. Stopping simulation</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-35">        fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb10-36">        dump<span class="op">(</span>file <span class="op">=</span> dumpFile<span class="op">);</span></span>
<span id="cb10-37">        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-38">      <span class="op">}</span></span>
<span id="cb10-39">    <span class="op">}</span></span>
<span id="cb10-40">    assert<span class="op">(</span>ke <span class="op">&lt;</span> <span class="fl">1e2</span><span class="op">);</span></span>
<span id="cb10-41"></span>
<span id="cb10-42">    <span class="co">// Check for energy dissipation below threshold</span></span>
<span id="cb10-43">    <span class="cf">if</span> <span class="op">(</span>ke <span class="op">&lt;</span> <span class="fl">1e-6</span> <span class="op">&amp;&amp;</span> i <span class="op">&gt;</span> <span class="fl">1e1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-44">      <span class="cf">if</span> <span class="op">(</span>pid<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-45">        fprintf<span class="op">(</span>ferr<span class="op">,</span> <span class="st">&quot;kinetic energy too small now! Stopping!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-46">        dump<span class="op">(</span>file <span class="op">=</span> dumpFile<span class="op">);</span></span>
<span id="cb10-47">        fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;log&quot;</span><span class="op">,</span> <span class="st">&quot;a&quot;</span><span class="op">);</span></span>
<span id="cb10-48">        fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">&quot;kinetic energy too small now! Stopping!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-49">        fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb10-50">        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb10-51">      <span class="op">}</span></span>
<span id="cb10-52">    <span class="op">}</span></span>
<span id="cb10-53">  <span class="op">}</span></span>
<span id="cb10-54"><span class="op">}</span></span></code></pre></div></div>
            </div>
        </main>

        <footer class="site-footer">
            <div class="footer-left">
              <a href="http://basilisk.fr/sandbox/vatsal/" target="_blank">
                <img src="../assets/logos/logoBasilisk_TransparentBackground.png" alt="Basilisk C" class="footer-logo">
              </a>
              <a href="https://pof.tnw.utwente.nl/" target="_blank">
                <img src="../assets/logos/LogoPof_transparent_white.png" alt="Physics of Fluids" class="footer-logo pof-logo">
              </a>
              <a href="https://www.utwente.nl/" target="_blank">
                <img src="../assets/logos/UT_Logo_2400_Sta_White_EN.png" alt="University of Twente" class="footer-logo">
              </a>
              <a href="https://www.vatsalsanjay.com/" target="_blank">
                <img src="../assets/logos/Logo_Vatsal_v3_OutLine.png" alt="Vatsal Sanjay" class="footer-logo">
              </a>
            </div>
            <div class="footer-center">
              <p class="copyright-text">
                &copy; Copyright<br>
                CoMPhy Lab 2025
              </p>
            </div>
            <div class="footer-right">
              <a href="https://scholar.google.com/citations?user=tHb_qZoAAAAJ&hl=en" target="_blank" aria-label="Google Scholar Profile">
                <i class="ai ai-google-scholar" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://github.com/comphy-lab" target="_blank" aria-label="GitHub Organization">
                <i class="fa-brands fa-github" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://www.youtube.com/@CoMPhyLab" target="_blank" aria-label="YouTube Channel">
                <i class="fa-brands fa-youtube" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://x.com/VatsalSanjay" target="_blank" aria-label="X (Twitter) Profile">
                <i class="fa-brands fa-x-twitter" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://bsky.app/profile/comphy-lab.org" target="_blank" aria-label="Bluesky Profile">
                <i class="fa-brands fa-bluesky" style="font-size: 2.5em; color: white;"></i>
              </a>
              <a href="https://github.com/comphy-lab/Viscoelastic-Worthington-jets-and-droplets-produced-by-bursting-bubbles" class="edit-link" aria-label="Edit this page on GitHub">
                <i class="fa-brands fa-github"></i> Edit this page
              </a>
            </div>
          </footer>
    </div>  

    <!-- Command Palette -->
    <div id="simple-command-palette" class="simple-command-palette" style="display: none;">
        <div class="simple-command-palette-backdrop"></div>
        <div class="simple-command-palette-modal">
            <input type="text" id="command-palette-input" placeholder="Type a command..." autocomplete="off">
            <div id="command-palette-results" class="command-palette-results"></div>
            <div class="command-palette-footer">
                <span class="command-palette-footer-item"><kbd>↑</kbd> <kbd>↓</kbd> to navigate</span>
                <span class="command-palette-footer-item"><kbd>enter</kbd> to select</span>
                <span class="command-palette-footer-item"><kbd>esc</kbd> to close</span>
            </div>
        </div>
    </div>


<script type="text/javascript">
document.addEventListener('DOMContentLoaded', function() {
    // Add copy button to each code block container
    const codeBlocks = document.querySelectorAll('.code-block-container pre');
    codeBlocks.forEach(function(codeBlock, index) {
        // Create button element
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        button.setAttribute('aria-label', 'Copy code to clipboard');
        button.setAttribute('data-copy-state', 'copy');
        
        // Get the code block container (parent of the pre)
        const container = codeBlock.parentNode;
        
        // Add the button to the container
        container.appendChild(button);
        
        // Set up click event
        button.addEventListener('click', async function() {
            const codeText = codeBlock.textContent;
            
            try {
                // Try to use the modern clipboard API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(codeText);
                    updateButtonState(button, 'success');
                } else {
                    // Fall back to the deprecated execCommand method
                    const textarea = document.createElement('textarea');
                    textarea.value = codeText;
                    textarea.style.position = 'fixed';  // Prevent scrolling to the bottom
                    document.body.appendChild(textarea);
                    textarea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textarea);
                    
                    if (successful) {
                        updateButtonState(button, 'success');
                    } else {
                        updateButtonState(button, 'error');
                    }
                }
            } catch (err) {
                console.error('Copy failed:', err);
                updateButtonState(button, 'error');
            }
        });
    });
    
    // Function to update button state
    function updateButtonState(button, state) {
        if (state === 'success') {
            button.textContent = 'Copied!';
            button.classList.add('copied');
        } else if (state === 'error') {
            button.textContent = 'Error!';
            button.classList.add('error');
        }
        
        // Reset button state after 2 seconds
        setTimeout(function() {
            button.textContent = 'Copy';
            button.classList.remove('copied', 'error');
        }, 2000);
    }
});
</script>
        </body>
</html>
